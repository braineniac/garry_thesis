\chapter{Kalman Filter}\label{cha:KalmanFilter}
\pagestyle{scrheadings}


\begin{itemize}
 \item Describe vaguely what a Kalman filter is and where it is used(with example applications)
 \item Explain why it is important in basic odometry and robotics
\end{itemize}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\section{Custom Kalman filter}\label{sec:custom_kalman}

\begin{itemize}
 \item Describe why we implemented a custom Kalman filter(insight to how it works I guess?)
 \item Maybe a better name for this section?
 \item add all the equations that describe the system from the code and add explanations with each step
 \item reference Kugi's script and how my system differs
\end{itemize}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\section{Extended Kalman Filter}\label{sec:extended_kalman}

\begin{itemize}
 \item Describe what it does and why it is better than my own Kalman filter
 \item Why do we also use this(reference later tests)
 \item Further reading in Kugi's script
\end{itemize}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\section{Simulation}\label{sec:sim}

\begin{itemize}
 \item Describe why the simulation was necessary and what purpose it serves.
 \item Describe what the real inputs look like(add ref) and why you chose the specific mathematical description(add equations)
 \item Hypotesize about the effects of covariances
\end{itemize}
\hrulefill
\begin{itemize}
 \item Before this input figure, describe the actual parameters in the equations and why you chose them
\end{itemize}

\begin{figure}[h]
 \begin{subfigure}[b]{0.45\textwidth}
  \input{plots/input_vel_sim.tex}\label{InputVelSim}
  \caption{Simulated input from joystick}
 \end{subfigure}
 \hfill
 \begin{subfigure}[b]{0.45\textwidth}
  \input{plots/input_accel_sim.tex}\label{InputAccelSim}
  \caption{Simulated input from accelerometer}
 \end{subfigure}
 \caption{Input simulation}
\end{figure}

\begin{itemize}
 \item Explain why the figures below look like this
 \item Describe the stdevs you chose and how they impacted the velocity(add ref for the actual comparison below)
 \item TODO: fix the $m/s^2 and 5*10^-2$ in figures
\end{itemize}

\begin{figure}[H]
 \flushleft
 \begin{subfigure}[c]{0.8\textwidth}
  \input{plots/robot_dist_sim.tex}\label{RobotDistSim}
  \caption{Kalman filter x state}
 \end{subfigure}
 \hfill
 \begin{subfigure}[c]{0.8\textwidth}
  \input{plots/robot_vel_sim.tex}\label{RobotVelSim}
  \caption{Kalman filter $\dot{x}$ state}
 \end{subfigure}
 \hfill
 \begin{subfigure}[c]{0.8\textwidth}
  \input{plots/robot_accel_sim.tex}\label{RobotAccelSim}
  \caption{Kalman filter $\ddot{x}$ state}
 \end{subfigure}
 \caption{Kalman filter states}
\end{figure}

\begin{itemize}
 \item Describe how changing the stdev ratio impacts the velocity(ref Kalman filter covariances)
 \item Add three velocity figures with >,<,= stdevs(a bit exaggerated ones)
 \item Explain why the variation of stdevs is important during different situations(standing still, moving)
\end{itemize}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\section{Driving in a straight line}\label{sec:straight_line}

\begin{itemize}
 \item Explain why this test is important->longer paths are made out of the sum of straight lines(garry cant turn and move forward, add ref to limitations)
\end{itemize}

\subsection{Simulation vs reality}\label{subsec:simvsreal}
\begin{itemize}
 \item Describe how the real input differs from the simulated one
 \item add two real input figures side by side
\end{itemize}
\hrulefill
\begin{itemize}
 \item Explain the differences between the real and simulated Kalman states(with static covar)
 \item add 3 figures like in the sim figure
\end{itemize}

\subsection{Covariance dependance}\label{subsec:covardep}
\begin{itemize}
 \item Explain why the adaptive covariance during the different phases(standing still, moving) smooths out the the $\dot{x}$ state during movement
 \item add two figures of the $\dot{x}$ state with static and adaptive covariance
\end{itemize}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\subsection{EKF vs custom Kalman filter comparison}\label{subsec:ekfvscustom}
\begin{itemize}
 \item add section for comparison between ekf and custom kalman filter
 \item add a $\dot{x}$ figure of the two side by side
 \item check out if they deal with variations in input velocity differently(+-20,+-50\%)
 \item add figures for differences
\end{itemize}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\subsection{Odometry dependance on acceleration}\label{subsec:odomdepaccel}
\begin{itemize}
 \item disable acceleration and compare that with the Kalman filter results
 \item add figure with comparison in distance
\end{itemize}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\section{Looping though an octagon}\label{sec:octagon}

\begin{itemize}
 \item Explain why we are doing this test->see drifts after each loop
 \item Describe testing parameters(setup of ekf package)
 \item Describe what happens in the figure below
 \item add figure
\end{itemize}
