\documentclass[class=article, crop=false]{standalone}
\usepackage[subpreambles=true]{standalone}
\usepackage{import}
\input{../packages}
\begin{document}

\subsection{State estimation}\label{subsec:stateest}

Our state estimation was done with our Kalman Filter described in Section \ref{sec:customkalman}. We devised a simulation that is meant to test changes in our Kalman Filter during development. It simulates the robot running in a straight line, then stopping. The values were chosen in the equations to reflect what we expect from the real sensor inputs. This can be seen in Figure \ref{fig:inputsim}.

The simulation was set up with the following steps:

\noindent
1, Define the wheel encoder input as a boxcar function f(x).

\noindent
2, Define a gaussian function with $\sigma$ = 0.03:
\begin{center}
    $ g(x) =  \dfrac{1}{\sqrt{2\pi\sigma}} e^{-\frac{1}{2} (x/\sigma)^2} $
\end{center}

\noindent
3, Convolve f(x) and g(x):
\begin{center}
    $ h(x) = f(x) \ast g(x) $
\end{center}

\noindent
4, Calculate the gradient of h(x) to get the expected smooth acceleration:
\begin{center}
    $ y(x) =  \nabla h(x)$
\end{center}

\noindent
5, Add gaussian noise while moving and standing still with peak of 0.02 and 2.0 respectively.

\vspace{0.5cm}

\begin{figure}[H]
\begin{flushleft}
  \begin{tikzpicture}
    \begin{axis}[
      yticklabel style={
        /pgf/number format/fixed,
        /pgf/number format/precision=5
      },
      width=12cm,
      height=5cm,
      xtick distance=0.5,
      xlabel={Time $[s]$},
      ylabel={$ \textbf{u}^0_k$ $[m/s]$},
      grid=both,
      grid style={
        line width=.1pt,
        draw=gray!10},
        major grid style={
          line width=.2pt,
          draw=gray!50
        },
      ]
      \addplot+[color=blue, mark=none,line width=1pt,mark size=1pt] table {../plots/sim_input_vel.csv};
    \end{axis}
  \end{tikzpicture}
\end{flushleft}

\begin{flushleft}
  \begin{tikzpicture}
    \begin{axis}[
      yticklabel style={
        /pgf/number format/fixed,
        /pgf/number format/precision=5
      },
      width=12cm,
      height=5cm,
      xtick distance=0.5,
      xlabel={Time $[s]$},
      ylabel={$ \textbf{u}^1_k$ $[m/s^2] $},
      grid=both,
      grid style={
        line width=.1pt,
        draw=gray!10},
        major grid style={
          line width=.2pt,
          draw=gray!50
        },
      ]
      \addplot+[color=blue, mark=none,line width=1pt,mark size=1pt] table {../plots/sim_input_accel.csv};
    \end{axis}
  \end{tikzpicture}
\end{flushleft}
\caption{Simulated $ \textbf{u}_k $ input to the system }\label{fig:inputsim}
\end{figure}

Futhermore we will try to determine how our custom Kalman Filter behaves with and without adaptive covariance feature described in \ref{subsec:customkalman}. We used a ratio of $ \textbf{r}_{k} = \frac{1}{3} $.


\vspace{0.5cm}

\begin{figure}[H]
  \begin{flushleft}
    \begin{tikzpicture}
      \begin{axis}[
        yticklabel style={
          /pgf/number format/fixed,
          /pgf/number format/precision=5
          },
          width=12cm,
          height=5cm,
          xtick distance=0.5,
          xlabel={Time $[s]$},
          ylabel={$\textbf{x}_k$ state $[m]$},
          legend pos=north west,
          grid=both,
          grid style={
            line width=.1pt,
            draw=gray!10},
          major grid style={
            line width=.2pt,
            draw=gray!50
          },
      ]
      \addplot+[smooth,color=blue, mark=none,line width=1pt,mark size=1pt] table {../plots/sim_robot_dist_None.csv};
      \addlegendentry{none}
      \addplot+[smooth,color=red, mark=none,line width=1pt,mark size=1pt, dashed] table {../plots/sim_robot_dist_exp.csv};
      \addlegendentry{exp}
      \end{axis}
    \end{tikzpicture}

    \begin{tikzpicture}
      \begin{axis}[
        yticklabel style={
          /pgf/number format/fixed,
          /pgf/number format/precision=5
        },
        width=12cm,
        height=5cm,
        xtick distance=0.5,
        ytick distance=0.05,
        xlabel={Time $[s]$},
        ylabel={$\dot{\textbf{x}}_k$ state $[m/s]$},
        legend pos=north west,
        grid=both,
        grid style={
          line width=.1pt,
          draw=gray!10},
        major grid style={
          line width=.2pt,
          draw=gray!50
        },
      ]
      \addplot+[color=red, mark=none,line width=1pt,mark size=1pt] table {../plots/sim_robot_vel_None.csv};
      \addlegendentry{none}
      \addplot+[color=blue, mark=none,line width=1pt,mark size=1pt, dashed] table {../plots/sim_robot_vel_exp.csv};
      \addlegendentry{exp}
      \end{axis}
    \end{tikzpicture}

  \end{flushleft}
\caption{No window compared to the exponential window}
\end{figure}\label{fig:exp}

\begin{figure}[H]
  \begin{flushleft}
    \begin{tikzpicture}
      \begin{axis}[
        yticklabel style={
          /pgf/number format/fixed,
          /pgf/number format/precision=5
          },
          width=12cm,
          height=5cm,
          xtick distance=0.5,
          xlabel={Time $[s]$},
          ylabel={$\textbf{x}_k$ state $[m]$},
          legend pos=north west,
          grid=both,
          grid style={
            line width=.1pt,
            draw=gray!10},
          major grid style={
            line width=.2pt,
            draw=gray!50
          },
      ]
      \addplot+[smooth,color=blue, mark=none,line width=1pt,mark size=1pt] table {../plots/sim_robot_dist_None.csv};
      \addlegendentry{none}
      \addplot+[smooth,color=red, mark=none,line width=1pt,mark size=1pt, dashed] table {../plots/sim_robot_dist_sig.csv};
      \addlegendentry{sig}
      \end{axis}
    \end{tikzpicture}

    \begin{tikzpicture}
      \begin{axis}[
        yticklabel style={
          /pgf/number format/fixed,
          /pgf/number format/precision=5
        },
        width=12cm,
        height=5cm,
        xtick distance=0.5,
        ytick distance=0.05,
        xlabel={Time $[s]$},
        ylabel={$\dot{\textbf{x}}_k$ state $[m/s]$},
        legend pos=north west,
        grid=both,
        grid style={
          line width=.1pt,
          draw=gray!10},
        major grid style={
          line width=.2pt,
          draw=gray!50
        },
      ]
      \addplot+[color=red, mark=none,line width=1pt,mark size=1pt] table {../plots/sim_robot_vel_None.csv};
      \addlegendentry{none}
      \addplot+[color=blue, mark=none,line width=1pt,mark size=1pt, dashed] table {../plots/sim_robot_vel_sig.csv};
      \addlegendentry{sig}
      \end{axis}
    \end{tikzpicture}

  \end{flushleft}
\caption{No window compared to the mirrored sigmoid window}
\end{figure}\label{fig:sig}

\vspace{0.5cm}

The exact effects on the system's $x$ and $\dot{x}$ states can be seen in Figures \ref{fig:exp} and \ref{fig:sig}. We can observe that the mirrored sigmoid window suppresses the acceleration component faster than the exponential one. This is due to their shape as we can see in Figure \ref{fig:ratios}.

\vspace{0.5cm}

\begin{figure}[H]
  \begin{flushleft}
        \begin{tikzpicture}
      \begin{axis}[
        yticklabel style={
          /pgf/number format/fixed,
          /pgf/number format/precision=5
        },
        width=12cm,
        height=5cm,
        xtick distance=0.5,
        xlabel={Time $[s]$},
        ylabel={$\textbf{r}_k$},
        legend pos=north west,
        grid=both,
        grid style={
          line width=.1pt,
          draw=gray!10},
        major grid style={
          line width=.2pt,
          draw=gray!50
        },
      ]
      \addplot+[color=red, mark=none,line width=1pt,mark size=1pt] table {../plots/sim_robot_ratio_sig.csv};
      \addlegendentry{sig}
      \addplot+[color=blue, mark=none,line width=1pt,mark size=1pt, dashed] table {../plots/sim_robot_ratio_exp.csv};
      \addlegendentry{exp}
      \end{axis}
    \end{tikzpicture}
  \end{flushleft}
\caption{Ratio change with different window functions}\label{fig:ratios}
\end{figure}

\end{document}
