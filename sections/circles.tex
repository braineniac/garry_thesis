\documentclass[class=article, crop=false]{standalone}
%\usepackage[subpreambles=true]{standalone}
\usepackage{import}
%\input{../packages}
\begin{document}

\section{Localization drift}\label{sec:circles}
For our next experiment we decided to test our robot's potential drift over time while running robot\_localization's ekf\_localization\_node. We used this over our own Kalman Filter, because we haven't yet included a yaw input in its design.

We ran the robot in an octagon pattern with a side length of approximately 66cm-s. We chose this shape because of relative ease to drive the robot straight then turn and its similarity to a circle. By driving the robot in a loop through this octagonal path, we can observe the drift in its localization.

Since it is a relatively long experiment, small changes in the localization settings will have a bigger impact on the path of the robot.

In the first part of the experiment we will discuss the results of our state estimation, then in the second part how well the acceleration from the IMU refines it. In the third part we change the ratio $ \textbf{r}_{k} $ and see how it effects our state estimation.

\subsection{State estimation results}\label{subsec:octagonstate}


In our localization settings as an input we used our fake wheel encoder as an $\dot{x}$ in the robots relative x direction, the accelerometer's relative x direction as $\ddot{x}$ and the gyroscope's yaw velocity as an $\dot{\psi}$. The standard deviation of the fake wheel encoder in relation to the accelerometer's was set by an intermediate node to $ \textbf{r}_{k} = \frac{1}{3}$.

We set the rate of our ekf\_localization\_node to 10Hz, which is $ \frac{1}{5}$ of our IMU accelerometer's rate for better results.

We know that the IMU is slightly off center on the robot, so in order to avoid drifts we account for it by defining its position in our Unified Robot Description Format (URDF) model of the robot\footnotemark, which is then automatically transformed by robot\_localization to the same frame as the fake wheel encoder.

\footnotetext{https://github.com/braineniac/garry-description}

\vspace{0.5cm}

\begin{figure}[H]
 \begin{flushleft}
  \begin{tikzpicture}
   \begin{axis}[
     unit vector ratio =1 1,
     yticklabel style={
       /pgf/number format/fixed,
       /pgf/number format/precision=5
      },
     width=12cm,
     height=12cm,
     xtick distance = 0.2,
     ytick distance = 0.2,
     xlabel={x $[m]$},
     ylabel={y $[m]$},
     grid=both,
     grid style={
       line width=.1pt,
       draw=gray!10},
     major grid style={
       line width=.2pt,
       draw=gray!50
      },
    ]
    \addplot+[color=blue, mark=none,line width=1pt,mark size=1pt] table {plots/loop_xy_10imu.csv};
\end{axis}
  \end{tikzpicture}
 \end{flushleft}
 \caption{Octagon x-y state estimation}\label{fig:octagonxy}
\end{figure}

The octagon shape seen in Figure \ref{fig:octagonxy} drifts in the x direction about 1.25m. This is due to the gyroscope drifting over the course of the experiment. This drift cannot be observed in y or $\psi$ as seen in Figure \ref{fig:octagon_xyyaw}, because the discrepency occures only in reality and can be corrected by another sensor, most commonly a magnetometer.

The red line in Figure \ref{fig:octagon_xyyaw} signifies how this drift changes over time. It is the signal output of a Butterworth filter of order 5 that was set to cutoff frequency of 50Hz. We chose this frequency, because it tracks the zero points of the sinusoids of x and y adequately.

\vspace{0.5cm}

\begin{figure}[H]
 \begin{flushleft}
\vspace{0.1cm}
  \begin{tikzpicture}
   \begin{axis}[
     yticklabel style={
       /pgf/number format/fixed,
       /pgf/number format/precision=5
      },
     width=12cm,
     height=5cm,
     xtick distance = 50,
     ytick distance = 0.5,
     xlabel={Time $[s]$},
     ylabel={x $[m] $},
     grid=both,
     grid style={
       line width=.1pt,
       draw=gray!10},
     major grid style={
       line width=.2pt,
       draw=gray!50
      },
    ]
    \addplot+[color=blue, mark=none,line width=1pt,mark size=1pt] table {plots/loop_x_10imu.csv};
    \addplot+[color=red, mark=none, line width=1pt, mark size=1pt] table {plots/loop_x_filter_50_10imu.csv};
   \end{axis}
  \end{tikzpicture}

  \begin{tikzpicture}
   \begin{axis}[
     yticklabel style={
       /pgf/number format/fixed,
       /pgf/number format/precision=5
      },
     width=12cm,
     height=5cm,
     xtick distance = 50,
     ytick distance = 0.5,
     xlabel={Time $[s]$},
     ylabel={y $[m] $},
     grid=both,
     grid style={
       line width=.1pt,
       draw=gray!10},
     major grid style={
       line width=.2pt,
       draw=gray!50
      },
    ]
    \addplot+[color=blue, mark=none,line width=1pt,mark size=1pt] table {plots/loop_y_10imu.csv};
    \addplot+[color=red, mark=none, line width=1pt, mark size=1pt] table {plots/loop_y_filter_50_10imu.csv};
   \end{axis}
  \end{tikzpicture}
  \begin{tikzpicture}
   \begin{axis}[
     yticklabel style={
       /pgf/number format/fixed,
       /pgf/number format/precision=5
      },
     width=12cm,
     height=5cm,
     xtick distance = 50,
     ytick distance = 1.5,
     xlabel={Time $[s]$},
     ylabel={$\psi$ $[rad] $},
     grid=both,
     grid style={
       line width=.1pt,
       draw=gray!10},
     major grid style={
       line width=.2pt,
       draw=gray!50
      },
    ]
    \addplot+[color=blue, mark=none,line width=1pt,mark size=1pt] table {plots/loop_yaw_10imu.csv};
   \end{axis}
  \end{tikzpicture}
 \end{flushleft}
 \caption{Octagon $x$, $y$ and $\psi$ plots}\label{fig:octagon_xyyaw}
\end{figure}

\subsection{IMU refinement in the state estimation}\label{subsec:imuref}

In this section we compare our state estimation results that were done with the IMU's accelerometer with just using the IMU's $\dot{\psi}$ and our fake wheel encoder's $\dot{x}$. We simply disabled the input in the localization settings.

\vspace{0.5cm}

\begin{figure}[H]
 \begin{flushleft}
  \begin{tikzpicture}
   \begin{axis}[
     unit vector ratio =1 1,
     yticklabel style={
       /pgf/number format/fixed,
       /pgf/number format/precision=5
      },
     width=12cm,
     height=12cm,
     xtick distance = 0.2,
     ytick distance = 0.2,
     xlabel={x $[m]$},
     ylabel={y $[m]$},
     grid=both,
     grid style={
       line width=.1pt,
       draw=gray!10},
     major grid style={
       line width=.2pt,
       draw=gray!50
      },
    ]
    \addplot+[color=blue, mark=none,line width=1pt,mark size=1pt] table {plots/loop_xy_10noimu.csv};\addlegendentry{no imu}
    \addplot+[color=red, mark=none,line width=1pt,mark size=1pt, dashed] table {plots/loop_xy_10imu.csv};\addlegendentry{with imu}
   \end{axis}
  \end{tikzpicture}
 \end{flushleft}
 \caption{IMU refining our state estimation}\label{fig:imuvsnoimu}
\end{figure}

As we can see in Figure \ref{fig:imuvsnoimu}, the IMU barely improves our state estimation. This is due to setting our fake wheel encoder to be more reliable than our IMU's x acceleration. The acceleration parts just don't effect the fake wheel encoder significantly.

In the next section we explore what happens if we change $ \textbf{r}_{k} $.

\subsection{Effects of ratio change}\label{subsec:ratiochange}

Since we couldn't significantly impact the state estimation in the last Subsection, we change the $ \textbf{r}_{k} $ so that the fake wheel encoder is less reliable than our accelerometer.

\begin{figure}[H]
 \begin{flushleft}
  \begin{tikzpicture}
   \begin{axis}[
     unit vector ratio =1 1,
     yticklabel style={
       /pgf/number format/fixed,
       /pgf/number format/precision=5
      },
     width=12cm,
     height=12cm,
     xtick distance = 0.2,
     ytick distance = 0.2,
     xlabel={x $[m]$},
     ylabel={y $[m]$},
     grid=both,
     grid style={
       line width=.1pt,
       draw=gray!10},
     major grid style={
       line width=.2pt,
       draw=gray!50
      },
    ]
    \addplot+[color=blue, mark=none,line width=1pt,mark size=1pt] table {plots/loop_xy_ratio3.csv};\addlegendentry{$ \textbf{r}_{k} = 3 $}
    \addplot+[color=red, mark=none,line width=1pt,mark size=1pt, dashed] table {plots/loop_xy_10imu.csv};\addlegendentry{$ \textbf{r}_{k} = \frac{1}{3}$}
   \end{axis}
  \end{tikzpicture}
 \end{flushleft}
 \caption{Octagon x-y estimation with different ratios}\label{fig:ratiodiff}
\end{figure}

Figure \ref{fig:ratiodiff} shows that the impact of this change, it drifts our estimation in the y direction and distorts the edges of the octagon.

\vspace{0.5cm}

\begin{figure}[H]
 \begin{flushleft}
  \begin{tikzpicture}
   \begin{axis}[
     yticklabel style={
       /pgf/number format/fixed,
       /pgf/number format/precision=5
      },
     width=12cm,
     height=5cm,
     xtick distance = 50,
     ytick distance = 0.5,
     xlabel={Time $[s]$},
     ylabel={x $[m] $},
     grid=both,
     grid style={
       line width=.1pt,
       draw=gray!10},
     major grid style={
       line width=.2pt,
       draw=gray!50
      },
    ]
    \addplot+[color=red, mark=none,line width=1pt,mark size=1pt,dashed] table {plots/loop_x_10imu.csv};
    \addplot+[color=blue, mark=none, line width=1pt, mark size=1pt] table {plots/loop_x_ratio3.csv};
   \end{axis}
  \end{tikzpicture}

  \begin{tikzpicture}
   \begin{axis}[
     yticklabel style={
       /pgf/number format/fixed,
       /pgf/number format/precision=5
      },
     width=12cm,
     height=5cm,
     xtick distance = 50,
     ytick distance = 0.5,
     xlabel={Time $[s]$},
     ylabel={y $[m] $},
     grid=both,
     grid style={
       line width=.1pt,
       draw=gray!10},
     major grid style={
       line width=.2pt,
       draw=gray!50
      },
    ]
    \addplot+[color=red, mark=none,line width=1pt,mark size=1pt, dashed] table {plots/loop_y_10imu.csv};
    \addplot+[color=blue, mark=none, line width=1pt, mark size=1pt] table {plots/loop_y_ratio3.csv};
   \end{axis}
  \end{tikzpicture}
  \begin{tikzpicture}
   \begin{axis}[
     yticklabel style={
       /pgf/number format/fixed,
       /pgf/number format/precision=5
      },
     width=12cm,
     height=5cm,
     xtick distance = 50,
     ytick distance = 1.5,
     xlabel={Time $[s]$},
     ylabel={$\psi$ $[rad] $},
     grid=both,
     grid style={
       line width=.1pt,
       draw=gray!10},
     major grid style={
       line width=.2pt,
       draw=gray!50
      },
    ]
    \addplot+[color=red, mark=none,line width=1pt,mark size=1pt, dashed] table {plots/loop_yaw_10imu.csv};
    \addplot+[color=blue, mark=none,line width=1pt,mark size=1pt] table {plots/loop_yaw_ratio3.csv};
   \end{axis}
  \end{tikzpicture}
 \end{flushleft}
 \caption{Octagon $x$, $y$ and $\psi$ states with different ratios}\label{fig:octagon_xyyaw_ratios}
\end{figure}

As we can see in Figure \ref{fig:octagon_xyyaw_ratios}, the new ratio even improves our x state estimation slightly, but it drifts our y state estimation about 0.5 meters.


\end{document}
