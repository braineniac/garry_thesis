\documentclass[class=article, crop=false]{standalone}
%\usepackage[subpreambles=true]{standalone}
\usepackage{import}
%\input{../packages}
\begin{document}
\pgfplotsset{width=14cm,compat=1.9}
\section{Adaptive covariance comparison}\label{sec:adapt}

In our first experiment we will try to determine how our Simple Kalman Filter(SKF) behaves with and without adaptive covariance feature described in \ref{subsec:simple-kalman}.

As the system input we used he Gamepads button press as an approximate velocity input $ \textbf{u}^0_k $ from a fake wheel encoder, which was previously measured to have a top speed of 0.2821 $m/s(we set it to half speed) $, and the acceleration $ \textbf{u}^1_k$ from our Razor IMU as seen in Figure \ref{fig:input}. Throughout the whole experiment we used a ratio of $ \textbf{r}_{k} = \frac{1}{3} $, which stands for a wheel encoder to IMU standard deviation ratio.

\vspace{0.5cm}

\begin{figure}[H]
\begin{flushleft}
  \begin{tikzpicture}
    \begin{axis}[
      yticklabel style={
        /pgf/number format/fixed,
        /pgf/number format/precision=5
      },
      width=12cm,
      height=5cm,
      xtick distance=0.5,
      ytick distance=0.05,
      xlabel={Time $[s]$},
      ylabel={$ \textbf{u}^0_k$ $[m/s]$},
      grid=both,
      grid style={
        line width=.1pt,
        draw=gray!10},
        major grid style={
          line width=.2pt,
          draw=gray!50
        },
      ]
      \addplot+[color=blue, mark=none,line width=1pt,mark size=1pt] table {plots/real_input_vel.csv};
    \end{axis}
  \end{tikzpicture}
\end{flushleft}

\begin{flushleft}
  \begin{tikzpicture}
    \begin{axis}[
      yticklabel style={
        /pgf/number format/fixed,
        /pgf/number format/precision=5
      },
      width=12cm,
      height=5cm,
      xtick distance=0.5,
      ytick distance=1,
      xlabel={Time $[s]$},
      ylabel={$ \textbf{u}^1_k$ $[m/s^2] $},
      grid=both,
      grid style={
        line width=.1pt,
        draw=gray!10},
        major grid style={
          line width=.2pt,
          draw=gray!50
        },
      ]
      \addplot+[color=blue, mark=none,line width=1pt,mark size=1pt] table {plots/real_input_accel.csv};
    \end{axis}
  \end{tikzpicture}
\end{flushleft}
\caption{$ \textbf{u}_k $ input to the system }\label{fig:input}
\end{figure}

\vspace{0.5cm}

The robot was moved in a straight line and the messages from the wheel encoder(Gamepad) and IMU were recorded with rosbag for later processing. Launching the state and filter nodes was done offline with the rosbag recording for proper direct comparison of the estimated states. In our first comparison the adaptive ability of the Simple Kalman Filter was disabled.

\vspace{0.5cm}

\begin{figure}[H]
  \begin{flushleft}
    \begin{tikzpicture}
      \begin{axis}[
        yticklabel style={
          /pgf/number format/fixed,
          /pgf/number format/precision=5
          },
          width=12cm,
          height=5cm,
          xtick distance=0.5,
          xlabel={Time $[s]$},
          ylabel={$\textbf{x}_k$ state $[m]$},
          legend pos=north west,
          grid=both,
          grid style={
            line width=.1pt,
            draw=gray!10},
          major grid style={
            line width=.2pt,
            draw=gray!50
          },
      ]
      \addplot+[smooth,color=blue, mark=none,line width=1pt,mark size=1pt] table {plots/real_robot_dist_None.csv};
      \addlegendentry{none}
      \addplot+[smooth,color=red, mark=none,line width=1pt,mark size=1pt, dashed] table {plots/real_robot_dist_exp.csv};
      \addlegendentry{exp}
      \end{axis}
    \end{tikzpicture}

    \begin{tikzpicture}
      \begin{axis}[
        yticklabel style={
          /pgf/number format/fixed,
          /pgf/number format/precision=5
        },
        width=12cm,
        height=5cm,
        xtick distance=0.5,
        ytick distance=0.05,
        xlabel={Time $[s]$},
        ylabel={$\dot{\textbf{x}}_k$ state $[m/s]$},
        legend pos=north west,
        grid=both,
        grid style={
          line width=.1pt,
          draw=gray!10},
        major grid style={
          line width=.2pt,
          draw=gray!50
        },
      ]
      \addplot+[color=red, mark=none,line width=1pt,mark size=1pt] table {plots/real_robot_vel_None.csv};
      \addlegendentry{none}
      \addplot+[color=blue, mark=none,line width=1pt,mark size=1pt, dashed] table {plots/real_robot_vel_exp.csv};
      \addlegendentry{exp}
      \end{axis}
    \end{tikzpicture}

  \end{flushleft}
\caption{No window compared to the exponential window}
\end{figure}\label{fig:exp}

\begin{figure}[H]
  \begin{flushleft}
    \begin{tikzpicture}
      \begin{axis}[
        yticklabel style={
          /pgf/number format/fixed,
          /pgf/number format/precision=5
          },
          width=12cm,
          height=5cm,
          xtick distance=0.5,
          xlabel={Time $[s]$},
          ylabel={$\textbf{x}_k$ state $[m]$},
          legend pos=north west,
          grid=both,
          grid style={
            line width=.1pt,
            draw=gray!10},
          major grid style={
            line width=.2pt,
            draw=gray!50
          },
      ]
      \addplot+[smooth,color=blue, mark=none,line width=1pt,mark size=1pt] table {plots/real_robot_dist_None.csv};
      \addlegendentry{none}
      \addplot+[smooth,color=red, mark=none,line width=1pt,mark size=1pt, dashed] table {plots/real_robot_dist_sig.csv};
      \addlegendentry{sig}
      \end{axis}
    \end{tikzpicture}

    \begin{tikzpicture}
      \begin{axis}[
        yticklabel style={
          /pgf/number format/fixed,
          /pgf/number format/precision=5
        },
        width=12cm,
        height=5cm,
        xtick distance=0.5,
        ytick distance=0.05,
        xlabel={Time $[s]$},
        ylabel={$\dot{\textbf{x}}_k$ state $[m/s]$},
        legend pos=north west,
        grid=both,
        grid style={
          line width=.1pt,
          draw=gray!10},
        major grid style={
          line width=.2pt,
          draw=gray!50
        },
      ]
      \addplot+[color=red, mark=none,line width=1pt,mark size=1pt] table {plots/real_robot_vel_None.csv};
      \addlegendentry{none}
      \addplot+[color=blue, mark=none,line width=1pt,mark size=1pt, dashed] table {plots/real_robot_vel_sig.csv};
      \addlegendentry{sig}
      \end{axis}
    \end{tikzpicture}

  \end{flushleft}
\caption{No window compared to the mirrored sigmoid window}
\end{figure}\label{fig:sig}

\vspace{0.5cm}

The exact effects on the system's $x$ and $\dot{x}$ states can be seen in Figures \ref{fig:exp} and \ref{fig:sig}. We can observe that the mirrored sigmoid window suppresses the acceleration component faster than the exponential one. This is due to their shape as we can see in \ref{fig:ratios}. We will further discuss utility of this feature in our next experiment.

\vspace{0.5cm}

\begin{figure}[H]
  \begin{flushleft}
        \begin{tikzpicture}
      \begin{axis}[
        yticklabel style={
          /pgf/number format/fixed,
          /pgf/number format/precision=5
        },
        width=12cm,
        height=5cm,
        xtick distance=0.5,
        xlabel={Time $[s]$},
        ylabel={$\textbf{r}_k$},
        legend pos=north west,
        grid=both,
        grid style={
          line width=.1pt,
          draw=gray!10},
        major grid style={
          line width=.2pt,
          draw=gray!50
        },
      ]
      \addplot+[color=red, mark=none,line width=1pt,mark size=1pt] table {plots/real_robot_ratio_sig.csv};
      \addlegendentry{sig}
      \addplot+[color=blue, mark=none,line width=1pt,mark size=1pt, dashed] table {plots/real_robot_ratio_exp.csv};
      \addlegendentry{exp}
      \end{axis}
    \end{tikzpicture}
  \end{flushleft}
\caption{Ratio change with different window functions}\label{fig:ratios}
\end{figure}

\end{document}
