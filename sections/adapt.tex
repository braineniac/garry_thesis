\documentclass[class=article, crop=false]{standalone}
%\usepackage[subpreambles=true]{standalone}
\usepackage{import}
\input{../packages}
\begin{document}
\pgfplotsset{width=14cm,compat=1.9}
\section{Adaptive covariance comparison}\label{sec:expcovar}

In our first experiment we will try to determine how effective our Simple Kalman Filter(SKF) is with and without adaptive covariance described in \ref{sec:simple-kalman}.

As the system input we used the Gamepads button press as an approximate velocity input, which we previously measured, and the acceleration from our Razor IMU. We used a ratio of $ \textbf{r}_{k} = \frac{1}{3} $. This can be seen in Figure \ref{fig:input}.

\vspace{0.5cm}

\begin{figure}
\begin{flushleft}
  \begin{tikzpicture}
    \begin{axis}[
      yticklabel style={
        /pgf/number format/fixed,
        /pgf/number format/precision=5
      },
      width=12cm,
      height=5cm,
      xtick distance=0.5,
      ytick distance=0.05,
      xlabel={Time $[s]$},
      ylabel={$ \textbf{u}^0_k$ $[m/s]$},
      grid=both,
      grid style={
        line width=.1pt,
        draw=gray!10},
        major grid style={
          line width=.2pt,
          draw=gray!50
        },
      ]
      \addplot+[color=blue, mark=none,line width=1pt,mark size=1pt] table {../plots/real_input_vel.csv};
    \end{axis}
  \end{tikzpicture}
\end{flushleft}

\begin{flushleft}
  \begin{tikzpicture}
    \begin{axis}[
      yticklabel style={
        /pgf/number format/fixed,
        /pgf/number format/precision=5
      },
      width=12cm,
      height=5cm,
      xtick distance=0.5,
      ytick distance=1,
      xlabel={Time $[s]$},
      ylabel={$ \textbf{u}^1_k$ $[m/s^2] $},
      grid=both,
      grid style={
        line width=.1pt,
        draw=gray!10},
        major grid style={
          line width=.2pt,
          draw=gray!50
        },
      ]
      \addplot+[color=blue, mark=none,line width=1pt,mark size=1pt] table {../plots/real_input_accel.csv};
    \end{axis}
  \end{tikzpicture}
\end{flushleft}
\caption{$ \textbf{u}_k $ input to the system }\label{fig:input}
\end{figure}

\vspace{0.5cm}

The robot was moved in a straight line and the messages from the Gamepad and IMU were recorded with rosbag. Launching the filter nodes was done offline with the rosbag recording for proper direct comparison of the estimated states. In this case the adaptive ability of the Simple Kalman Filter was disabled. We used a ratio of $ \textbf{r}_{k} = \frac{1}{3} $.

\vspace{0.5cm}

\begin{figure}
  \begin{flushleft}
    \begin{tikzpicture}
      \begin{axis}[
        yticklabel style={
          /pgf/number format/fixed,
          /pgf/number format/precision=5
          },
          width=12cm,
          height=5cm,
          xtick distance=0.5,
          xlabel={Time $[s]$},
          ylabel={$\textbf{x}_k$ state $[m]$},
          legend pos=north west,
          grid=both,
          grid style={
            line width=.1pt,
            draw=gray!10},
          major grid style={
            line width=.2pt,
            draw=gray!50
          },
      ]
      \addplot+[smooth,color=blue, mark=none,line width=1pt,mark size=1pt] table {../plots/real_robot_dist_None.csv};
      \addlegendentry{none}
      \addplot+[smooth,color=red, mark=none,line width=1pt,mark size=1pt, dashed] table {../plots/real_robot_dist_exp.csv};
      \addlegendentry{exp}
      \end{axis}
    \end{tikzpicture}

    \begin{tikzpicture}
      \begin{axis}[
        yticklabel style={
          /pgf/number format/fixed,
          /pgf/number format/precision=5
        },
        width=12cm,
        height=5cm,
        xtick distance=0.5,
        ytick distance=0.05,
        xlabel={Time $[s]$},
        ylabel={$\dot{\textbf{x}}_k$ state $[m/s]$},
        legend pos=north west,
        grid=both,
        grid style={
          line width=.1pt,
          draw=gray!10},
        major grid style={
          line width=.2pt,
          draw=gray!50
        },
      ]
      \addplot+[color=red, mark=none,line width=1pt,mark size=1pt] table {../plots/real_robot_vel_None.csv};
      \addlegendentry{none}
      \addplot+[color=blue, mark=none,line width=1pt,mark size=1pt, dashed] table {../plots/real_robot_vel_exp.csv};
      \addlegendentry{exp}
      \end{axis}
    \end{tikzpicture}

  \end{flushleft}
\caption{Exponential window comparioson}
\end{figure}\label{fig:exp}

\begin{figure}
  \begin{flushleft}
    \begin{tikzpicture}
      \begin{axis}[
        yticklabel style={
          /pgf/number format/fixed,
          /pgf/number format/precision=5
          },
          width=12cm,
          height=5cm,
          xtick distance=0.5,
          xlabel={Time $[s]$},
          ylabel={$\textbf{x}_k$ state $[m]$},
          legend pos=north west,
          grid=both,
          grid style={
            line width=.1pt,
            draw=gray!10},
          major grid style={
            line width=.2pt,
            draw=gray!50
          },
      ]
      \addplot+[smooth,color=blue, mark=none,line width=1pt,mark size=1pt] table {../plots/real_robot_dist_None.csv};
      \addlegendentry{none}
      \addplot+[smooth,color=red, mark=none,line width=1pt,mark size=1pt, dashed] table {../plots/real_robot_dist_sig.csv};
      \addlegendentry{sig}
      \end{axis}
    \end{tikzpicture}

    \begin{tikzpicture}
      \begin{axis}[
        yticklabel style={
          /pgf/number format/fixed,
          /pgf/number format/precision=5
        },
        width=12cm,
        height=5cm,
        xtick distance=0.5,
        ytick distance=0.05,
        xlabel={Time $[s]$},
        ylabel={$\dot{\textbf{x}}_k$ state $[m/s]$},
        legend pos=north west,
        grid=both,
        grid style={
          line width=.1pt,
          draw=gray!10},
        major grid style={
          line width=.2pt,
          draw=gray!50
        },
      ]
      \addplot+[color=red, mark=none,line width=1pt,mark size=1pt] table {../plots/real_robot_vel_None.csv};
      \addlegendentry{none}
      \addplot+[color=blue, mark=none,line width=1pt,mark size=1pt, dashed] table {../plots/real_robot_vel_sig.csv};
      \addlegendentry{sig}
      \end{axis}
    \end{tikzpicture}

  \end{flushleft}
\caption{Sigmoid window comparison}
\end{figure}\label{fig:sig}

\vspace{0.5cm}

The exact effects on the system's $x$ and $\dot{x}$ states can be seen in Figures \ref{fig:exp} and \ref{fig:sig}.
\vspace{0.5cm}

\begin{figure}
  \begin{flushleft}
        \begin{tikzpicture}
      \begin{axis}[
        yticklabel style={
          /pgf/number format/fixed,
          /pgf/number format/precision=5
        },
        width=12cm,
        height=5cm,
        xtick distance=0.5,
        xlabel={Time $[s]$},
        ylabel={$\textbf{r}_k$},
        legend pos=north west,
        grid=both,
        grid style={
          line width=.1pt,
          draw=gray!10},
        major grid style={
          line width=.2pt,
          draw=gray!50
        },
      ]
      \addplot+[color=red, mark=none,line width=1pt,mark size=1pt] table {../plots/real_robot_ratio_sig.csv};
      \addlegendentry{sig}
      \addplot+[color=blue, mark=none,line width=1pt,mark size=1pt, dashed] table {../plots/real_robot_ratio_exp.csv};
      \addlegendentry{exp}
      \end{axis}
    \end{tikzpicture}
  \end{flushleft}
\caption{Ratio change with different window functions}\label{fig:ratios}
\end{figure}

\vspace{0.5cm}

We can observe in Figure \ref{fig:ratios} the covariance change which is supplied to the system.

\end{document}
