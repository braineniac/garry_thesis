\documentclass[class=article, crop=false]{standalone}
%\usepackage[subpreambles=true]{standalone}
\usepackage{import}
%\input{../packages}
\begin{document}
\pgfplotsset{width=14cm,compat=1.9}
\section{Simple Kalman Filter comparison}\label{sec:simplevsekf}

To compare and verify our implementation of the state estimating node in our custom Kalman Filter(cKF), we used the ekf\_localization\_node from the robot\_localization\cite{MooreStouchKeneralizedEkf2014} package as a reference.
It is a versatile non-linear state estimation node for robots in 3-D space without restriction on the number of sensors and tracks 15-dimensional internal states.

The robot was moved in a straight line and the messages from the wheel encoder and IMU were recorded with rosbag for later processing. The sensor data can be seen in Fugure \ref{fig:realinput}.

Launching the state and filter nodes was done offline with the rosbag recording for proper direct comparison of the estimated states.

\vspace{0.5cm}

\begin{figure}[H]
\begin{flushleft}
  \begin{tikzpicture}
    \begin{axis}[
      yticklabel style={
        /pgf/number format/fixed,
        /pgf/number format/precision=5
      },
      width=12cm,
      height=5cm,
      xtick distance=0.5,
      ytick distance=0.05,
      xlabel={Time $[s]$},
      ylabel={$ \textbf{u}^0_k$ $[m/s]$},
      grid=both,
      grid style={
        line width=.1pt,
        draw=gray!10},
        major grid style={
          line width=.2pt,
          draw=gray!50
        },
      ]
      \addplot+[color=blue, mark=none,line width=1pt,mark size=1pt] table {plots/real_input_vel.csv};
    \end{axis}
  \end{tikzpicture}
\end{flushleft}

\begin{flushleft}
  \begin{tikzpicture}
    \begin{axis}[
      yticklabel style={
        /pgf/number format/fixed,
        /pgf/number format/precision=5
      },
      width=12cm,
      height=5cm,
      xtick distance=0.5,
      ytick distance=1,
      xlabel={Time $[s]$},
      ylabel={$ \textbf{u}^1_k$ $[m/s^2] $},
      grid=both,
      grid style={
        line width=.1pt,
        draw=gray!10},
        major grid style={
          line width=.2pt,
          draw=gray!50
        },
      ]
      \addplot+[color=blue, mark=none,line width=1pt,mark size=1pt] table {plots/real_input_accel.csv};
    \end{axis}
  \end{tikzpicture}
\end{flushleft}
\caption{$ \textbf{u}_k $ input to the system }\label{fig:realinput}
\end{figure}

\vspace{0.5cm}


\begin{figure}[H]
\begin{flushleft}
\begin{tikzpicture}
  \begin{axis}[
    yticklabel style={
      /pgf/number format/fixed,
      /pgf/number format/precision=5
    },
    width=12cm,
    height=5cm,
    xtick distance=0.5,
    ytick distance=0.05,
    xlabel={Time $[s]$},
    ylabel={$\textbf{x}_k$ state $[m]$},
    legend pos=north west,
    grid=both,
    grid style={
      line width=.1pt,
      draw=gray!10},
      major grid style={
        line width=.2pt,
        draw=gray!50
      },
    ]
    \addplot+[smooth,color=blue, mark=none,line width=1pt,mark size=1pt, dashed] table {plots/ekf_pos.csv};
    \addlegendentry{EKF}
    \addplot+[smooth,color=red, mark=none,line width=1pt,mark size=1pt] table {plots/real_robot_dist_None.csv};
    \addlegendentry{cKF}
  \end{axis}
\end{tikzpicture}
\end{flushleft}

\begin{flushleft}
\begin{tikzpicture}
  \begin{axis}[
    yticklabel style={
      /pgf/number format/fixed,
      /pgf/number format/precision=5
    },
    width=12cm,
    height=5cm,
    xtick distance=0.5,
    ytick distance=0.05,
    xlabel={Time $[s]$},
    ylabel={$\dot{\textbf{x}}_k$ state $[m/s]$},
    legend pos=north west,
    grid=both,
    grid style={
      line width=.1pt,
      draw=gray!10},
      major grid style={
        line width=.2pt,
        draw=gray!50
      },
    ]
    \addplot+[color=blue, mark=none,line width=1pt,mark size=1pt, dashed] table {plots/ekf_vel.csv};
    \addlegendentry{EKF}
    \addplot+[color=red, mark=none,line width=1pt,mark size=1pt] table {plots/real_robot_vel_None.csv};
    \addlegendentry{SKF}
  \end{axis}
\end{tikzpicture}
\end{flushleft}
\caption{EKF and SKF state estimation}\label{fig:ekfnone}
\end{figure}

We can see the difference in Figure \ref{fig:ekfnone} in how the acceleration during movement is transfers in the $\dot{\textbf{x}}_k $ state estimation. SFK deals better with such erratic changes in $ \textbf{u}^1_k $ and smooths them out compared to the EKF. The EKF on the other hand can deal better with our sudden jumps in $ \textbf{u}^0_k $ and it and smooths it out in $\dot{\textbf{x}}_k$. We will attempt to approximate similar behavior with the adaptive covariance feature of cKF.

\vspace{0.5cm}

\begin{figure}[H]
\begin{flushleft}
\begin{tikzpicture}
  \begin{axis}[
    yticklabel style={
      /pgf/number format/fixed,
      /pgf/number format/precision=5
    },
    width=12cm,
    height=5cm,
    xtick distance=0.5,
    ytick distance=0.05,
    xlabel={Time $[s]$},
    ylabel={$\textbf{x}_k$ state $[m]$},
    legend pos=north west,
    grid=both,
    grid style={
      line width=.1pt,
      draw=gray!10},
      major grid style={
        line width=.2pt,
        draw=gray!50
      },
    ]
    \addplot+[smooth,color=blue, mark=none,line width=1pt,mark size=1pt, dashed] table {plots/ekf_pos.csv};
    \addlegendentry{EKF}
    \addplot+[smooth,color=red, mark=none,line width=1pt,mark size=1pt] table {plots/real_robot_dist_sig.csv};
    \addlegendentry{SKF(sig)}
  \end{axis}
\end{tikzpicture}
\end{flushleft}

\begin{flushleft}
\begin{tikzpicture}
  \begin{axis}[
    yticklabel style={
      /pgf/number format/fixed,
      /pgf/number format/precision=5
    },
    width=12cm,
    height=5cm,
    xtick distance=0.5,
    ytick distance=0.05,
    xlabel={Time $[s]$},
    ylabel={$\dot{\textbf{x}}_k$ state $[m/s]$},
    legend pos=north west,
    grid=both,
    grid style={
      line width=.1pt,
      draw=gray!10},
      major grid style={
        line width=.2pt,
        draw=gray!50
      },
    ]
    \addplot+[color=blue, mark=none,line width=1pt,mark size=1pt, dashed] table {plots/ekf_vel.csv};
    \addlegendentry{EKF}
    \addplot+[color=red, mark=none,line width=1pt,mark size=1pt] table {plots/real_robot_vel_sig.csv};
    \addlegendentry{cKF(sig)}
  \end{axis}
\end{tikzpicture}
\end{flushleft}
\caption{EKF and cKF(sig) state estimation}\label{fig:ekfsig}
\end{figure}

As seen in Figure \ref{fig:ekfsig} the adaptive covariance feature somewhat improves the $\dot{\textbf{x}}_k $ estimation after the jump in $ \textbf{u}^0_k $, but its nowhere nearly as smooth as in EKF, regardless of the window function chosen.

This might translate to inaccuracies in localization over time, because the the acceleration phase of the robot does not properly contribute to its position. This is however not a problem in short distances with light robots that achieve their top speed almost instantly as in our case.

The smoothing of our cKF filter during movement may also filter out slippage and uneven ground while our robot is moving, which adds up to more errors over time.

\end{document}
