\documentclass[class=article, crop=false]{standalone}
%\usepackage[subpreambles=true]{standalone}
\usepackage{import}
\input{../packages}
\begin{document}
\pgfplotsset{width=14cm,compat=1.9}
\section{Simple Kalman Filter comparison}\label{sec:expcomp}

In this experiment we compare our Simple Kalman Filter(SKF) to the robot\_localization package's Extended Kalman Filter(EKF). We used the same system input and experiment parameters as described in Section \ref{sec:expcovar} for direct comparability.

\vspace{0.5cm}

\begin{figure}
\begin{flushleft}
\begin{tikzpicture}
  \begin{axis}[
    yticklabel style={
      /pgf/number format/fixed,
      /pgf/number format/precision=5
    },
    width=12cm,
    height=5cm,
    xtick distance=0.5,
    ytick distance=0.05,
    xlabel={Time $[s]$},
    ylabel={$\textbf{x}_k$ state $[m]$},
    legend pos=north west,
    grid=both,
    grid style={
      line width=.1pt,
      draw=gray!10},
      major grid style={
        line width=.2pt,
        draw=gray!50
      },
    ]
    \addplot+[smooth,color=blue, mark=none,line width=1pt,mark size=1pt, dashed] table {../plots/ekf_pos.csv};
    \addlegendentry{EKF}
    \addplot+[smooth,color=red, mark=none,line width=1pt,mark size=1pt] table {../plots/real_robot_dist_None.csv};
    \addlegendentry{SKF}
  \end{axis}
\end{tikzpicture}
\end{flushleft}

\begin{flushleft}
\begin{tikzpicture}
  \begin{axis}[
    yticklabel style={
      /pgf/number format/fixed,
      /pgf/number format/precision=5
    },
    width=12cm,
    height=5cm,
    xtick distance=0.5,
    ytick distance=0.05,
    xlabel={Time $[s]$},
    ylabel={$\dot{\textbf{x}}_k$ state $[m/s]$},
    legend pos=north west,
    grid=both,
    grid style={
      line width=.1pt,
      draw=gray!10},
      major grid style={
        line width=.2pt,
        draw=gray!50
      },
    ]
    \addplot+[color=blue, mark=none,line width=1pt,mark size=1pt, dashed] table {../plots/ekf_vel.csv};
    \addlegendentry{EKF}
    \addplot+[color=red, mark=none,line width=1pt,mark size=1pt] table {../plots/real_robot_vel_None.csv};
    \addlegendentry{SKF}
  \end{axis}
\end{tikzpicture}\label{fig:xdotcompare}
\end{flushleft}
\caption{$ \textbf{x}_k $ and $\dot{\textbf{x}}_k $ state estimate comparison}\label{fig:statescompare}
\end{figure}

We can see the difference in Figure \ref{fig:statescompare} in how the acceleration during movement is transfers in the $\dot{\textbf{x}}_k $ state estimation. SFK deals better with such erratic changes in $ \textbf{u}^1_k $ and smooths them out compared to the EKF. The EKF on the other hand can deal better with our sudden jumps in $ \textbf{u}^0_k and it and smooths it out in $\dot{\textbf{x}}_k$. We will attempt to approximate similar behavior with the adaptive covariance feature of SKF.

\vspace{0.5cm}

\begin{figure}
\begin{flushleft}
\begin{tikzpicture}
  \begin{axis}[
    yticklabel style={
      /pgf/number format/fixed,
      /pgf/number format/precision=5
    },
    width=12cm,
    height=5cm,
    xtick distance=0.5,
    ytick distance=0.05,
    xlabel={Time $[s]$},
    ylabel={$\textbf{x}_k$ state $[m]$},
    legend pos=north west,
    grid=both,
    grid style={
      line width=.1pt,
      draw=gray!10},
      major grid style={
        line width=.2pt,
        draw=gray!50
      },
    ]
    \addplot+[smooth,color=blue, mark=none,line width=1pt,mark size=1pt, dashed] table {../plots/ekf_pos.csv};
    \addlegendentry{EKF}
    \addplot+[smooth,color=red, mark=none,line width=1pt,mark size=1pt] table {../plots/real_robot_dist_sig.csv};
    \addlegendentry{SKF(sig)}
  \end{axis}
\end{tikzpicture}
\end{flushleft}

\begin{flushleft}
\begin{tikzpicture}
  \begin{axis}[
    yticklabel style={
      /pgf/number format/fixed,
      /pgf/number format/precision=5
    },
    width=12cm,
    height=5cm,
    xtick distance=0.5,
    ytick distance=0.05,
    xlabel={Time $[s]$},
    ylabel={$\dot{\textbf{x}}_k$ state $[m/s]$},
    legend pos=north west,
    grid=both,
    grid style={
      line width=.1pt,
      draw=gray!10},
      major grid style={
        line width=.2pt,
        draw=gray!50
      },
    ]
    \addplot+[color=blue, mark=none,line width=1pt,mark size=1pt, dashed] table {../plots/ekf_vel.csv};
    \addlegendentry{EKF}
    \addplot+[color=red, mark=none,line width=1pt,mark size=1pt] table {../plots/real_robot_vel_sig.csv};
    \addlegendentry{SKF(sig)}
  \end{axis}
\end{tikzpicture}\label{fig:xdotcompare}
\end{flushleft}
\caption{$ \textbf{x}_k $ and $\dot{\textbf{x}}_k $ state estimate comparison}\label{fig:statescompare}
\end{figure}

As seen in Figure \ref{fig:statescompare} the adaptive covariance feature somewhat improves the $\dot{\textbf{x}}_k $ estimation after the jump in $ \textbf{u}^0_k $, but its nowhere nearly as smooth as in EKF, regardless of the window function chosen.

This might translate to inaccuracies in localization over time, because the the acceleration phase of the robot does not properly contribute to its position. This is however not a problem in short distances with light robots that achieve their top speed almost instantly as in our case.

The smoothing of our SKF filter during movement may also filter out slippage and uneven ground while our robot is moving, which adds up to more errors over time.

\end{document}
